{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "from scipy import stats\n",
    "import scipy.stats as ss"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Задача:\\\n",
    "\n",
    "У вас есть несколько ресторанов в разных частях города и целый штат курьеров. Но есть одна проблема — к вечеру скорость доставки падает из-за того, что курьеры уходят домой после рабочего дня, а количество заказов лишь растет. Это приводит к тому, что в момент пересмены наша доставка очень сильно проседает в эффективности. \n",
    "\n",
    "Наши data scientist-ы придумали новый алгоритм, который позволяет курьерам запланировать свои последние заказы перед окончанием рабочего дня так, чтобы их маршрут доставки совпадал с маршрутом до дома. То есть, чтобы курьеры доставляли последние свои заказы за день как бы \"по пути\" домой. \n",
    "\n",
    "Вы вместе с командой решили раскатить A/B тест на две равные группы курьеров. Часть курьеров использует старый алгоритм без опции \"по пути\", другие видят в своем приложении эту опцию и могут ее выбрать. Ваша задача – проанализировать данные эксперимента и помочь бизнесу принять решение о раскатке новой фичи на всех курьеров."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_csv('/mnt/HC_Volume_18315164/home-jupyter/jupyter-j-postnova/experiment_lesson_4.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>order_id</th>\n",
       "      <th>delivery_time</th>\n",
       "      <th>district</th>\n",
       "      <th>experiment_group</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>3159</td>\n",
       "      <td>44.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>control</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>10426</td>\n",
       "      <td>51.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>control</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>9155</td>\n",
       "      <td>46.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>control</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>10699</td>\n",
       "      <td>34.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>control</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>10061</td>\n",
       "      <td>43.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>control</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20191</th>\n",
       "      <td>14561</td>\n",
       "      <td>42.0</td>\n",
       "      <td>Suburb</td>\n",
       "      <td>test</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20192</th>\n",
       "      <td>12015</td>\n",
       "      <td>32.0</td>\n",
       "      <td>Suburb</td>\n",
       "      <td>test</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20193</th>\n",
       "      <td>20077</td>\n",
       "      <td>23.0</td>\n",
       "      <td>Purlieus</td>\n",
       "      <td>test</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20194</th>\n",
       "      <td>14861</td>\n",
       "      <td>41.0</td>\n",
       "      <td>Central</td>\n",
       "      <td>test</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20195</th>\n",
       "      <td>13501</td>\n",
       "      <td>41.0</td>\n",
       "      <td>Central</td>\n",
       "      <td>test</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>20196 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "       order_id  delivery_time  district experiment_group\n",
       "0          3159           44.0  Purlieus          control\n",
       "1         10426           51.0  Purlieus          control\n",
       "2          9155           46.0  Purlieus          control\n",
       "3         10699           34.0  Purlieus          control\n",
       "4         10061           43.0  Purlieus          control\n",
       "...         ...            ...       ...              ...\n",
       "20191     14561           42.0    Suburb             test\n",
       "20192     12015           32.0    Suburb             test\n",
       "20193     20077           23.0  Purlieus             test\n",
       "20194     14861           41.0   Central             test\n",
       "20195     13501           41.0   Central             test\n",
       "\n",
       "[20196 rows x 4 columns]"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Для начала сформулируем гипотезы для проверки. \\\n",
    "Нулевая гипотеза (H0): Разницы между средним временем доставки в тестовой и контрольной группе нет\\\n",
    "Альтернативная гипотеза (H1): Разница между средним временем доставки в тестовой и контрольной группе есть\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "#построим гистограммы распредления времени доставки по районам в контрольной и в тестовой группе"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "district\n",
       "Central     AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Purlieus    AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Suburb      AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Name: delivery_time, dtype: object"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXcAAAD4CAYAAAAXUaZHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+j8jraAAASZklEQVR4nO3dcayddX3H8fdXKqK9paUUbyot3hqISuisXAIYyUJhbkWNkAUdzmk1mCYEGU7NqP4DLluG2WKniTNbwFkXsTLUQIrOkXKJcwloK1VKO2JB0DbVChT0YjRj++6P82t7entvz7ntufc853ffr+TkPr/f8zvP+Z4nz/mc5zznec6NzESSVJeX9LsASVLvGe6SVCHDXZIqZLhLUoUMd0mq0Lx+FwCwZMmSHBkZ6XcZR3nhhReYP39+v8vo2qDVC9Y8Wwat5kGrF/pT87Zt257OzDMmm9eIcB8ZGWHr1q39LuMoDzzwAJdeemm/y+jaoNUL1jxbBq3mQasX+lNzRDw11TwPy0hShQx3SaqQ4S5JFTLcJalChrskVchwl6QKGe6SVCHDXZIqZLhLUoUMd9XrloX9rkDqG8NddbhloWEutTHcJalChrskVchwl6QKGe6SVCHDXZIqZLhLUoUMd0mqkOEuSRUy3CWpQl2He0ScFBEPR8Tm0l4REQ9FxO6I+GpEnFz6X1bau8v8kZkpXZphXvWqATadPfcbgV1t7U8BGzLzbOAAcG3pvxY4UPo3lHGSpFnUVbhHxDLgbcBtpR3AZcBdZchG4KoyfWVpU+ZfXsZLkmZJZGbnQRF3AX8LLAA+BrwfeLDsnRMRy4FvZeZ5EbEDWJOZe8q8x4GLMvPpCctcB6wDGB4eHt20aVPPnlSvjI+PMzQ01O8yujZo9UIPa963vfV36aoj+9rbvVgmc3w9z5JBqxf6U/Pq1au3ZeYFk87MzGPegLcD/1imLwU2A0uA3W1jlgM7yvQOYFnbvMeBJcd6jNHR0WyisbGxfpcwLYNWb2YPa7751NZtYl+vl5lzfD3PkkGrN7M/NQNbc4pcndfFm8ObgXdExFuBU4BTgc8AiyJiXma+CCwD9pbxe0vY74mIecBC4JlpvBlJkk5Qx2PumfnxzFyWmSPANcD9mfkeYAy4ugxbC9xdpu8pbcr8+8s7jNQ/nvWiOeZEznO/CfhIROwGTgduL/23A6eX/o8A60+sRM0pnn4o9UQ3h2UOycwHgAfK9BPAhZOM+S3wzh7UJkk6Tl6hKkkVMtwlqUKGuyRVyHDX3OQXt6qc4S5JFTLc1XzuYUvTZrhLUoUMd+kgPyGoIoa7JFXIcJekChnuklQhw12SKmS4S9Phl64aEIa7JFXIcJekChnuklQhw12Dxx/9kjoy3CWpQoa7JFXIcJekChnuklQhw12zxy9CpVljuEtShQx3SaqQ4S5JFTLc1V/7tve7AqlKhrskVchwl6QKGe6SVCHDXZIqZLhLJ8ILs9RQhrskVchwl6QKGe6aOR6ukPrGcJekChnuklQhw12SKmS4S7PB7x80ywx3SapQx3CPiFMi4nsR8cOIeDQiPln6V0TEQxGxOyK+GhEnl/6XlfbuMn9kZp+CJGmibvbcfwdclplvAFYBayLiYuBTwIbMPBs4AFxbxl8LHCj9G8o4SdIs6hju2TJemi8ttwQuA+4q/RuBq8r0laVNmX95RETPKpYkdRSZ2XlQxEnANuBs4HPA3wEPlr1zImI58K3MPC8idgBrMnNPmfc4cFFmPj1hmeuAdQDDw8OjmzZt6t2z6pHx8XGGhob6XUbXGlfvvu2wdNWRbTiib/zZ/QwtfuUxx3SznI7363YZXYwZX3D24fU82ZjJTFz2LGvcttHBoNUL/al59erV2zLzgklnZmbXN2ARMAZcAuxu618O7CjTO4BlbfMeB5Yca7mjo6PZRGNjY/0uYVoaV+/Npx7dntA3dseGjmO6WU7H+013/DHGHLGej6eWPmjcttHBoNWb2Z+aga05Ra5O62yZzHyuhPubgEURMa/MWgbsLdN7S9hT5i8EnpnO40iSTkw3Z8ucERGLyvTLgbcAu2iF/NVl2Frg7jJ9T2lT5t9f3mEkSbNkXuchLAU2luPuLwHuzMzNEbET2BQRfw08DNxext8O/GtE7AaeBa6ZgbolScfQMdwz80fAGyfpfwK4cJL+3wLv7El1kqTj4hWqklQhw12SKmS4S1KFDHepH/zH2pphhrskVchwl6QKGe6SVCHDXZIqZLhLUoUMd/WGZ39IjWK4S1KFDHdJqpDhLkkVMtwlqUKGuyRVyHCXpAoZ7pJUIcNdkipkuEtShQx3qSm8wlc9ZLhLUoUMd0mqkOEuSRUy3CWpQoa7ps+f95Uaz3CXpAoZ7pJUIcNdkipkuEtShQx3deaXp9LAMdwlqUKGuyRVyHCXpAoZ7pJUIcNdR/LqU6kKhrskVchwl6QKGe6SVCHDXZIq1DHcI2J5RIxFxM6IeDQibiz9iyPivoj4cfl7WumPiPhsROyOiB9FxPkz/SQkSUfqZs/9ReCjmXkucDFwfUScC6wHtmTmOcCW0ga4Ajin3NYBn+951ZKkY+oY7pm5LzN/UKZ/DewCzgSuBDaWYRuBq8r0lcCXsuVBYFFELO155VLtPC1VJyAys/vBESPAd4DzgJ9m5qLSH8CBzFwUEZuBWzPzu2XeFuCmzNw6YVnraO3ZMzw8PLpp06YTfzY9Nj4+ztDQUL/L6FpP6t23vfV36aoj+ya2JxtzHPcbf3Y/Q4tfOfOP3+0yuhgzvuDsw+u5h+uiqzHHaU5uy7OsHzWvXr16W2ZeMOnMzOzqBgwB24A/Lu3nJsw/UP5uBi5p698CXHCsZY+OjmYTjY2N9buEaelJvTef2rpN7OtmzHHcb+yODbPz+D2qN28+9cj13MN10dWY4zQnt+VZ1o+aga05Ra52dbZMRLwU+Brw5cz8eun+xcHDLeXv/tK/F1jedvdlpU9N5Md+qUrdnC0TwO3Arsz8dNuse4C1ZXotcHdb//vKWTMXA89n5r4e1ixJ6mBeF2PeDLwXeCQiykFAPgHcCtwZEdcCTwHvKvO+CbwV2A38BvhATyuWJHXUMdyz9cVoTDH78knGJ3D9CdYlSToBXqEqSRUy3KVB4hfg6pLhLkkVMtwlqUKGuyRVyHCXpAoZ7tIg88fFNAXDfS4xCKQ5w3CXpAoZ7pJUIcNdkipkuEtShQx3SaqQ4S5JFTLcJalChrskVchwl6QKGe5SbbwKWRjuklQlw12SKmS4S1KFDHdJqpDhXjO/WJPmLMNdkipkuEtShQx3SaqQ4S5JFTLcJalChrskVchwl6QKGe6SVCHDXZIqZLhLc8G+7f2uQLPMcJekChnuklQhw12SKmS4S1KFDHdJqpDhLkkV6hjuEfGFiNgfETva+hZHxH0R8ePy97TSHxHx2YjYHRE/iojzZ7J4SdLkutlz/yKwZkLfemBLZp4DbCltgCuAc8ptHfD53pQpSZqOjuGemd8Bnp3QfSWwsUxvBK5q6/9StjwILIqIpb0qdi4bWX8vI+vvnXrALQu9UEXSIfOO837DmbmvTP8cGC7TZwI/axu3p/TtQ1Lfrdy48tD0I2sf6WMlmmmRmZ0HRYwAmzPzvNJ+LjMXtc0/kJmnRcRm4NbM/G7p3wLclJlbJ1nmOlqHbhgeHh7dtGlTD55Ob42PjzM0NNTvMgB4ZO/zAKw8c4p/er1vO+MvexVDi195RB9LVx3ZhqP7ejXmOO43/uz+o2ueicfv4fMcX3D24e2ih+tixsZweD3vfGbnob5zTz/30PRU/f3SpNdet/pR8+rVq7dl5gWTzszMjjdgBNjR1n4MWFqmlwKPlel/At492bhj3UZHR7OJxsbG+l3CIa++aXO++qbNUw+4+dQcu2PDUX1HtSfr69WY47jfpDXPxOP38HkesV30cF3M2Jg8vJ7P++J5h27tpurvlya99rrVj5qBrTlFrh7vqZD3AGvL9Frg7rb+95WzZi4Gns/Dh2/UQx2PwUua0zoec4+IrwCXAksiYg9wM3ArcGdEXAs8BbyrDP8m8FZgN/Ab4AMzULMkqYOO4Z6Z755i1uWTjE3g+hMtai47uDf+5K1v63Mlmqv80rUOXqEqSRUy3CWpQoa7JFXIcJekChnufeYpjZJmguEuSRUy3CWpQoa7JFXIcJekChnuklQhw12SKmS4S1KFDHdJqtDx/ps9SXOMvxY5WAx3SdNm0Defh2UkqUKGuyRVyHDvA38oTNJMM9wlqUKGuyRVyLNlZpD/7FpzjWfRNId77pJUIcNdkipkuEtShQx3SaqQ4S5JFTLcT8DI+nuPuCBpYluS+sVwl6QKGe6SVCEvYpI0I7q5oMmLnmaO4S5pVrUHumaOh2UKvwyVVBP33CdxMOS/uGZ+nyuRpOPjnnsX3KuXNGgMd0mNs/OZnazcuNLj8yfAcJekChnuklShOfeFqv9AQxp8nh/fWXXhbnhLc4tBPzkPy0hqNL9YPT4zsuceEWuAzwAnAbdl5q0z8TjdcE9empvm+s8f9DzcI+Ik4HPAW4A9wPcj4p7M3NnrxwLD+0SMrL+XJ0/pdxW9d+gFu+IsmvRyHVl/r9tpn5xIiA/qG8BM7LlfCOzOzCcAImITcCUwI+HejQWvX8/KjetLq28fIqZl4gb15Cl/WlrPT2s5nQJl5YqzoP0j74qzAPj1FPdbuXHloTHtm/nK0jdxWQfHTHwjOfj8rhu6jve3PVan5Uz1+FM+v7ag/3XbjkCnx5lYS/uLeuczO7lh4w0dazi47g/WvID1wOF1Oum6n/BYk41pX6cLXj95jRPXwXVD13HDVIc2bll4aJ3OZSf6BtBaxzcc0d/PTwyRmb1dYMTVwJrM/GBpvxe4KDM/NGHcOmBdab4WeKynhfTGEuDpfhcxDYNWL1jzbBm0mgetXuhPza/OzDMmm9G3s2Uy85+Bf+7X43cjIrZm5gX9rqNbg1YvWPNsGbSaB61eaF7NM3G2zF5geVt7WemTJM2SmQj37wPnRMSKiDgZuAa4ZwYeR5I0hZ4flsnMFyPiQ8C3aZ0K+YXMfLTXjzNLGn3YaBKDVi9Y82wZtJoHrV5oWM09/0JVktR/XqEqSRUy3CWpQoY7EBHLI2IsInZGxKMRcWPpXxwR90XEj8vf0/pd60ERcUpEfC8iflhq/mTpXxERD0XE7oj4avlSuzEi4qSIeDgiNpd20+t9MiIeiYjtEbG19DV2uwCIiEURcVdE/HdE7IqINzW55oh4bVm/B2+/iogPN7lmgIj4i/La2xERXymvycZsz4Z7y4vARzPzXOBi4PqIOBdYD2zJzHOALaXdFL8DLsvMNwCrgDURcTHwKWBDZp4NHACu7WONk7kR2NXWbnq9AKszc1XbOcxN3i6g9btO/56ZrwPeQGt9N7bmzHysrN9VwCjwG+AbNLjmiDgT+HPggsw8j9bJI9fQpO05M71NuAF30/ptnMeApaVvKfBYv2ubot5XAD8ALqJ1hdy80v8m4Nv9rq+tzmW0XqSXAZuBaHK9paYngSUT+hq7XQALgZ9QTpYYhJon1PmHwH81vWbgTOBnwGJaZx1uBv6oSduze+4TRMQI8EbgIWA4M/eVWT8HhvtU1qTKIY7twH7gPuBx4LnMfLEM2UNrI2yKfwD+Evi/0j6dZtcLkMB/RMS28pMZ0OztYgXwS+BfyuGv2yJiPs2uud01wFfKdGNrzsy9wN8DPwX20frRp200aHs23NtExBDwNeDDmfmr9nnZeitu1Hmjmfm/2foou4zWD7a9rs8lTSki3g7sz8xt/a5lmi7JzPOBK2gdrvv99pkN3C7mAecDn8/MNwIvMOFwRgNrBqAcn34H8G8T5zWt5nL8/0pab6avAuYDa/pa1ASGexERL6UV7F/OzK+X7l9ExNIyfymtPeTGyczngDFaHwMXRcTBi9Oa9NMPbwbeERFPAptoHZr5DM2tFzi0h0Zm7qd1HPhCmr1d7AH2ZOZDpX0XrbBvcs0HXQH8IDN/UdpNrvkPgJ9k5i8z83+Ar9PaxhuzPRvuQEQEcDuwKzM/3TbrHmBtmV5L61h8I0TEGRGxqEy/nNZ3BLtohfzVZVhjas7Mj2fmsswcofXR+/7MfA8NrRcgIuZHxIKD07SOB++gwdtFZv4c+FlEvLZ0XU7r57YbW3Obd3P4kAw0u+afAhdHxCtKfhxcz43Znr1CFYiIS4D/pPXz3AePB3+C1nH3O4GzgKeAd2Xms30pcoKI+D1gI61v6V8C3JmZfxURr6G1Z7wYeBj4s8z8Xf8qPVpEXAp8LDPf3uR6S23fKM15wB2Z+TcRcToN3S4AImIVcBtwMvAE8AHKNkJza55PKzBfk5nPl76mr+dPAn9C62y7h4EP0jrG3ojt2XCXpAp5WEaSKmS4S1KFDHdJqpDhLkkVMtwlqUKGuyRVyHCXpAr9P5Vp2ZWslLfRAAAAAElFTkSuQmCC\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "df.query(\"experiment_group == 'control'\").groupby('district')['delivery_time'].hist(bins=100)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "district\n",
       "Central     AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Purlieus    AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Suburb      AxesSubplot(0.125,0.125;0.775x0.755)\n",
       "Name: delivery_time, dtype: object"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "df.query(\"experiment_group == 'test'\").groupby('district')['delivery_time'].hist(bins=100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [],
   "source": [
    "#предварительно по графикам видны различия по времени доставки в разных районах, "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Проверим выполнение условий на нормальность и посчитаем стандартное отклонение в тесте и в контроле.\n",
    "Делаем семплирование перед применением критерия при проверке на нормальность (и для теста, и для контроля), так как на больших выборках вы можете получать неверные результаты: "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [],
   "source": [
    "from scipy.stats import shapiro"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "ShapiroResult(statistic=0.9975479245185852, pvalue=0.14013493061065674)"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "shapiro(df[df['experiment_group'] == 'test']['delivery_time'].sample(1000, random_state=17))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "ShapiroResult(statistic=0.9974725842475891, pvalue=0.12411931157112122)"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "shapiro(df[df['experiment_group'] == 'control']['delivery_time'].sample(1000, random_state=17))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Для того, чтобы проверить нормальность распределения, я использую \n",
    "SHAPIRO-WILK TEST. \\\n",
    "Этот тест показывает, что значения в тестовой группе распределены НОРМАЛЬНО\\\n",
    "В контрольной группе распределение является НОРМАЛЬНЫМ\\\n",
    "Стандартное отклонение времени доставки в тесте равно (округлите до сотых) 9.88\\\n",
    "Стандартное отклонение времени доставки в контроле равно (округлите до сотых) 9.99"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Для сравнения средних в данных экспериментальных группах я использую \n",
    "STUDENT'S T-TEST"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Ttest_indResult(statistic=43.03582663183714, pvalue=0.0)"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ss.ttest_ind(df[df['experiment_group'] == 'control']['delivery_time'], df[df['experiment_group'] == 'test']['delivery_time'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    ". Статистика в тесте равна -43, p-value <= 0.05, "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "На сколько процентов изменилось среднее время доставки в тестовой группе по сравнению с контрольной?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "45.065101070154576"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "c = df[df['experiment_group'] == 'control']['delivery_time'].mean()\n",
    "c"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "39.04681314330958"
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "t = df[df['experiment_group'] == 'test']['delivery_time'].mean()\n",
    "t"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "13.35"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "round (100 - t*100/c,2)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Что в итоге? Используем новую версию? Да, раскатываем новый алгоритм на всех, так как среднее время доставки статистически значимо изменилось. Среднее время доставки в тесте меньше, чем в контроле."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
